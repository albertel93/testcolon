<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Test de Colonias — Selección Progresiva</title>
<style>
body {background:#0b0f14;color:#e7eef7;font-family:system-ui,Arial,sans-serif;margin:0;padding:0}
.card{background:#121821;border:1px solid #202C3D;border-radius:14px;padding:20px;margin:20px auto;max-width:800px}
.btn{border:1px solid #2a3950;background:#1f2a3a;color:#e7eef7;padding:10px 16px;border-radius:10px;cursor:pointer}
.btn:hover{background:#243145}
.choice{border:1px dashed #2a3950;border-radius:12px;padding:18px;background:#121a2a;text-align:center;margin:10px}
.code{font-size:26px;font-weight:800;margin-bottom:8px}
.hidden{display:none}
.final-card{border:1px solid #2a3950;border-radius:12px;padding:14px;margin:10px;background:#121a2a}
.winner{border-color:#ffd54a;box-shadow:0 0 0 3px rgba(255,213,74,.15)}
.second{border-color:#c7d1da;box-shadow:0 0 0 3px rgba(199,209,218,.15)}
.third{border-color:#d6a171;box-shadow:0 0 0 3px rgba(214,161,113,.15)}
</style>
</head>
<body>
<div class="card" id="setup">
<h3>Inicio</h3>
<p>Colonias: 1, 2, 3, 5, 6, 7M, 7H, 8, 9</p>
<label>Nombre del sujeto:</label>
<input id="subject" style="width:100%;padding:8px;border-radius:8px;border:1px solid #243145;background:#111826;color:#fff">
<br><br><button class="btn" id="start">Empezar prueba</button>
</div>

<div class="card hidden" id="round1">
<h3>Ronda 1 · Emparejamientos fijos</h3>
<div id="r1pairs"></div>
<button class="btn hidden" id="toRound2">Ir a Ronda 2</button>
</div>

<div class="card hidden" id="round2">
<h3>Ronda 2 · Semifinal</h3>
<div id="r2pairs"></div>
<button class="btn hidden" id="toFinal">Ir a Final</button>
</div>

<div class="card hidden" id="final">
<h3>Ronda 3 · Final (1ª / 2ª / 3ª)</h3>
<div id="finalists"></div>
<button class="btn hidden" id="showResults">Mostrar resultados</button>
</div>

<div class="card hidden" id="results">
<h3>Resultados</h3>
<div id="resultContent"></div>
</div>

<script>
const LABELS=["1","2","3","5","6","7M","7H","8","9"];
let subject='',r1Pairs=[],r1Winners=[],r2Pairs=[],r2Winners=[],finalists=[],finalRanks={};
const $=s=>document.querySelector(s);
function el(t,c,txt){const e=document.createElement(t);if(c)e.className=c;if(txt)e.textContent=txt;return e;}
function clear(n){n.innerHTML='';}
function show(id,vis){$(id).classList.toggle('hidden',!vis);}

function buildRound1(){
 r1Pairs=[["1","2"],["3","5"],["6","7H"],["7M","8"]];
 r1Winners=[]; const bye="9"; const cont=$("#r1pairs"); clear(cont);
 r1Pairs.forEach(pair=>{
   const wrap=el('div'); wrap.style.display='flex'; wrap.style.justifyContent='space-around';
   pair.forEach(c=>{const d=el('div','choice');d.appendChild(el('div','code',c));
     const b=el('button','btn','Elegir');b.onclick=()=>{if(!r1Winners.includes(c))r1Winners.push(c);checkComplete();};
     d.appendChild(b);wrap.appendChild(d);});cont.appendChild(wrap);});
 function checkComplete(){if(r1Winners.length===r1Pairs.length){r1Winners.push(bye);$("#toRound2").classList.remove('hidden');}}
}

function buildRound2(){
 r2Pairs=[];r2Winners=[];const arr=r1Winners.slice();const bye=arr.pop();
 const cont=$("#r2pairs");clear(cont);
 for(let i=0;i<arr.length;i+=2){const pair=[arr[i],arr[i+1]];r2Pairs.push(pair);
   const wrap=el('div');wrap.style.display='flex';wrap.style.justifyContent='space-around';
   pair.forEach(c=>{const d=el('div','choice');d.appendChild(el('div','code',c));
     const b=el('button','btn','Elegir');b.onclick=()=>{if(!r2Winners.includes(c))r2Winners.push(c);checkComplete();};
     d.appendChild(b);wrap.appendChild(d);});cont.appendChild(wrap);}
 function checkComplete(){if(r2Winners.length===r2Pairs.length){r2Winners.push(bye);$("#toFinal").classList.remove('hidden');}}
}

function buildFinal(){
 finalists=r2Winners.slice();finalRanks={};
 const cont=$("#finalists");clear(cont);
 finalists.forEach(c=>{const d=el('div','final-card');d.appendChild(el('div','code',c));
 [1,2,3].forEach(rank=>{const b=el('button','btn',rank+'º');b.onclick=()=>setRank(c,rank);d.appendChild(b);});
 cont.appendChild(d);});
}

function setRank(c,rank){
 for(const k in finalRanks)if(finalRanks[k]===rank)delete finalRanks[k];
 finalRanks[c]=rank;
 document.querySelectorAll('.final-card').forEach(x=>x.classList.remove('winner','second','third'));
 for(const [cc,r] of Object.entries(finalRanks)){
   const card=[...document.querySelectorAll('.final-card')].find(x=>x.textContent.includes(cc));
   if(!card)continue;
   if(r===1)card.classList.add('winner');if(r===2)card.classList.add('second');if(r===3)card.classList.add('third');
 }
 if(Object.keys(finalRanks).length===3)$("#showResults").classList.remove('hidden');
}

function resultsView(){
 const box=$("#resultContent");clear(box);
 const arr=Object.entries(finalRanks).sort((a,b)=>a[1]-b[1]);
 box.appendChild(el('p',null,'Sujeto: '+subject));
 box.appendChild(el('p',null,'1ª: '+arr[0][0]+' | 2ª: '+arr[1][0]+' | 3ª: '+arr[2][0]));
 box.appendChild(el('p',null,'Finalistas: '+finalists.join(', ')));
}

$("#start").onclick=()=>{subject=$("#subject").value.trim();if(!subject)return alert('Introduce un nombre');
 show('#setup',false);show('#round1',true);buildRound1();};
$("#toRound2").onclick=()=>{show('#round1',false);show('#round2',true);buildRound2();};
$("#toFinal").onclick=()=>{show('#round2',false);show('#final',true);buildFinal();};
$("#showResults").onclick=()=>{show('#final',false);show('#results',true);resultsView();};
</script>
</body>
</html>
